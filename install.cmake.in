include(GetPrerequisites)

set(VCPKG_ROOT @VCPKG_INSTALLED_DIR@/@VCPKG_TARGET_TRIPLET@)

function(install_boost_deps)
    get_prerequisites(${ARGV0} _prereq 0 1 "" "${VCPKG_ROOT}/bin")
    foreach(_dll IN LISTS _prereq)
        string(REGEX MATCH "boost_.*dll" _match ${_dll})
        if(_match)
            file(COPY "${VCPKG_ROOT}/bin/${_dll}" DESTINATION ${CMAKE_INSTALL_PREFIX})
        endif()
    endforeach()
endfunction()

file(COPY "@Qt6_ROOT@/plugins/platforms/qwindows.dll" DESTINATION ${CMAKE_INSTALL_PREFIX}/platforms)
file(COPY "${VCPKG_ROOT}/bin/FLAC.dll" DESTINATION ${CMAKE_INSTALL_PREFIX})
file(COPY "${VCPKG_ROOT}/bin/zlib1.dll" DESTINATION ${CMAKE_INSTALL_PREFIX})
file(COPY "${VCPKG_ROOT}/bin/opus.dll" DESTINATION ${CMAKE_INSTALL_PREFIX})
file(COPY "${VCPKG_ROOT}/bin/mpg123.dll" DESTINATION ${CMAKE_INSTALL_PREFIX})
file(COPY "${VCPKG_ROOT}/bin/libmp3lame.dll" DESTINATION ${CMAKE_INSTALL_PREFIX})
install_boost_deps(${CMAKE_INSTALL_PREFIX}/lsd2dsl.exe)
install_boost_deps(${CMAKE_INSTALL_PREFIX}/lsd2dsl-gui.exe)
